<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>TWKT å®¢æˆ¶ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #5856D6;
            --background-color: #F2F2F7;
            --card-background: #FFFFFF;
            --text-primary: #000000;
            --text-secondary: #8E8E93;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            text-decoration: none;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding: 30px 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .menu-card {
            background: var(--card-background);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        .menu-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.2);
        }

        .menu-card:nth-child(1) .menu-icon { background: linear-gradient(135deg, #007AFF, #5856D6); }
        .menu-card:nth-child(2) .menu-icon { background: linear-gradient(135deg, #FF9500, #FF3B30); }
        .menu-card:nth-child(3) .menu-icon { background: linear-gradient(135deg, #34C759, #30D158); }

        .menu-icon {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .menu-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .menu-desc {
            font-size: 0.8125rem;
            color: var(--text-secondary);
        }

        @media screen and (max-width: 768px) {
            .menu-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>TWKT å®¢æˆ¶ä¸­å¿ƒ</h1>
        <a href="index.html" class="logout-btn" id="logoutBtn">ç™»å‡º</a>
    </div>

    <div class="menu-grid">
        <a href="å®¢æˆ¶åŸºæœ¬è³‡æ–™åŠè¨˜éŒ„.html" class="menu-card">
            <div class="menu-icon">ğŸ“‹</div>
            <div class="menu-title">åŸºæœ¬è³‡æ–™</div>
            <div class="menu-desc">å®¢æˆ¶åŸºæœ¬è³‡æ–™åŠè¨˜éŒ„</div>
        </a>

        <a href="æ¸›è‚¥æ­·å².html" class="menu-card">
            <div class="menu-icon">ğŸ“ˆ</div>
            <div class="menu-title">æ¸›è‚¥æ­·å²</div>
            <div class="menu-desc">é«”é‡è®ŠåŒ–ç´€éŒ„</div>
        </a>

        <a href="3æ—¥é£²é£Ÿè¨˜éŒ„.html" class="menu-card">
            <div class="menu-icon">ğŸ¥—</div>
            <div class="menu-title">3æ—¥é£²é£Ÿè¨˜éŒ„</div>
            <div class="menu-desc">é£²é£Ÿæ—¥èªŒ</div>
        </a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDChC0rBbTgAqB_me8_Jw6BgQY_WyV9GN0",
            authDomain: "twkt-91ddf.firebaseapp.com",
            projectId: "twkt-91ddf",
            storageBucket: "twkt-91ddf.firebasestorage.app",
            messagingSenderId: "754554349532",
            appId: "1:754554349532:web:d5060ecc92ea9df5309119",
            measurementId: "G-YYZEYVH1W5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦ç‚ºç®¡ç†å“¡
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                // æœªç™»å…¥ï¼Œè·³è½‰å›ç™»å…¥é 
                window.location.href = 'login.html';
                return;
            }

            // æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡
            const adminDoc = await getDoc(doc(db, "ç®¡ç†å“¡", user.uid));
            
            if (adminDoc.exists() && adminDoc.data().role === 'admin') {
                // ç®¡ç†å“¡ä¸èƒ½ä½¿ç”¨å®¢æˆ¶ä¸­å¿ƒï¼Œå¼·åˆ¶ç™»å‡º
                await signOut(auth);
                alert('ç®¡ç†å“¡è«‹å¾å¾Œå°ç™»å…¥');
                window.location.href = 'index.html';
            }
        });

        // ç™»å‡ºæŒ‰éˆ•
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            await signOut(auth);
            // ä½¿ç”¨ location.replace é˜²æ­¢å¾Œé€€
            window.location.replace('index.html');
        });

        // é˜²æ­¢é é¢è¢«ç·©å­˜
        window.onpageshow = function(event) {
            if (event.persisted) {
                onAuthStateChanged(auth, async (user) => {
                    if (!user) {
                        window.location.replace('login.html');
                    } else {
                        // æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡
                        const adminDoc = await getDoc(doc(db, "ç®¡ç†å“¡", user.uid));
                        if (adminDoc.exists() && adminDoc.data().role === 'admin') {
                            await signOut(auth);
                            window.location.replace('index.html');
                        }
                    }
                });
            }
        };

        // é é¢å¯è¦‹æ€§è®ŠåŒ–æ™‚é‡æ–°æª¢æŸ¥
        document.addEventListener('visibilitychange', async () => {
            if (document.visibilityState === 'visible') {
                onAuthStateChanged(auth, async (user) => {
                    if (!user) {
                        window.location.replace('login.html');
                    } else {
                        const adminDoc = await getDoc(doc(db, "ç®¡ç†å“¡", user.uid));
                        if (adminDoc.exists() && adminDoc.data().role === 'admin') {
                            await signOut(auth);
                            window.location.replace('index.html');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
